<!-- Custom Code Modal Content -->
<div *ngIf="isOpen" class="space-y-4">
  <div>
    <div class="flex items-center justify-between mb-2">
      <div class="block text-sm font-semibold text-gray-300">
        JavaScript Code:
      </div>
      <button
        *ngIf="customJsCode.length > 200"
        (click)="onToggleCodeExpansion()"
        class="text-xs text-gray-400 hover:text-orange-400 transition-colors px-2 py-1 rounded hover:bg-purple-900/30"
      >
        {{ isCustomCodeExpanded ? '‚ñº Collapse' : '‚ñ∂ Expand' }}
      </button>
    </div>
    <textarea
      [ngModel]="customJsCode"
      (ngModelChange)="onCodeChange($event)"
      class="w-full p-3 bg-customGray border border-purple-900 rounded text-gray-200 font-mono text-sm focus:outline-none focus:border-orange-500 resize-none"
      [class.h-64]="!isCustomCodeExpanded"
      [class.h-96]="isCustomCodeExpanded"
      placeholder="// Enter custom JavaScript code to execute on TV...&#10;// Example:&#10;const result = Hisense_GetBrand();&#10;console.log(result);&#10;return result;"
    ></textarea>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-3">
    <button
      (click)="onExecute()"
      [disabled]="isExecutingCustomCode || !customJsCode.trim()"
      class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed"
    >
      {{ isExecutingCustomCode ? '‚è≥ Executing...' : '‚ñ∂Ô∏è Execute Custom Code' }}
    </button>
  </div>

  <!-- Result Display -->
  <div *ngIf="customCodeResult !== null" class="mt-4">
    <div class="flex items-center justify-between mb-2">
      <div class="text-sm font-semibold text-orange-400">üìä Result:</div>
      <div class="flex gap-2">
        <button
          (click)="onCopyResult()"
          class="text-xs text-gray-400 hover:text-orange-400 transition-colors px-2 py-1 rounded hover:bg-purple-900/30"
          title="Copy to clipboard"
        >
          üìã Copy
        </button>
        <button
          *ngIf="shouldShowExpandButton(customCodeResult)"
          (click)="onToggleResultExpansion()"
          class="text-xs text-gray-400 hover:text-orange-400 transition-colors px-2 py-1 rounded hover:bg-purple-900/30"
        >
          {{ isCustomCodeResultExpanded ? '‚ñº Collapse' : '‚ñ∂ Expand' }}
        </button>
      </div>
    </div>
    <pre
      class="bg-customGray p-3 rounded border border-purple-900 font-mono text-xs overflow-y-auto text-gray-300"
      [class.max-h-48]="!isCustomCodeResultExpanded"
      [class.max-h-96]="isCustomCodeResultExpanded"
      >{{ formatResult(customCodeResult) }}</pre
    >
  </div>

  <!-- Executing Indicator -->
  <div *ngIf="isExecutingCustomCode" class="text-center text-orange-400">
    ‚è≥ Executing custom code on TV...
  </div>

  <!-- Warning -->
  <div
    class="mt-4 p-4 bg-orange-900/20 rounded-lg border-l-4 border-orange-500"
  >
    <div class="flex items-start gap-3">
      <span class="text-orange-400 text-xl">‚ö†Ô∏è</span>
      <div>
        <div class="text-sm font-semibold text-orange-400 mb-1">
          Security Warning
        </div>
        <p class="text-xs text-gray-400">
          Custom code is executed directly on the TV browser. Only run trusted
          code. Malicious code could potentially compromise the TV or network.
        </p>
      </div>
    </div>
  </div>
</div>
